---
title: Configuration Is Code
publishDate: 2017-08-07
modifyDate: 2017-08-07
author: Curt J. Sampson
email: cjs@cynic.net
template: post.jade
---

The [about page](/about) of this site briefly tells you that
"configuration is code"; this post goes into the details.

Back in the not-so-good old days of plain old Apache and PHP sites the
configuration file for Apache was almost invariably separate from the
site itself, usually stored in `/etc/` on the production server and
and its backup tapes and nowhere else. This persists even today as a
default for web server packages in most Linux distributions with the
configuration in `/etc/` but the data being read out of `/var/www`,
perhaps users' home directories, and who knows where else.

The configuration stored in these files can be divided into two basic
parts. One is configuration related to the particular installation of
the web server itself, such as the address and port on which to
listen, connection limits and other performance settings, location of
TLS key and certificate files, the locations of applications on this
server, and so on. The second part is what I call "application
configuration."

When I use the word "application" here I'm not talking just about code
executing on a server, accessing databases, and so on. I'm talking
about all the content being served, even if it's just static HTML, CSS
and JS files.[^1] Even a static website relies on a surprising amount
of web server configuration to work properly.

A typical example is URL rewriting and redirects; it's not uncommon
even for static sites to use redirects for, say, letting old links
work when a site reorganizes the paths it uses. An Apache configuration
fragment to do this might look like:

    RewriteEngine On
    RewriteRule ^contact/$ %{HTTP_HOST}/about/contact/ [R=301,L]

XXX confirm that `%{HTTP_HOST}` is correctly used here
XXX Check  https://mediatemple.net/community/products/dv/204643270/using-htaccess-rewrite-rules for other interesting stuff

The rewriting used by a site may be more subtle and hidden. It's
common for people to use links such as `/about` expecting that the
page that will be served will come from `about/index.html` in the
filesystem; this relies on two different configuration rules:

1. The `/about` path in an HTTP request will produce a redirect to a
   slightly different path, `/about/`, because the web server is
   configured to do that when the original path refers to a directory
   under the document root.

2. The `/about/` path actually quietly serves the content from
   `about/index.html` under the docroot.

This isn't even the end of it; there's more subtle work going on here.
A web server returns a `Content-type` header with every response;
correct setting of this is required for the browser to properly render
the content. The contents of this header isn't stored in the file
being served; web servers are typically configured to generate it
based on the file extension. Here's some example configuration
extracted `/etc/nginx/mime.types` on a Debian 9 system:

    types {
        text/html                             html htm shtml;
        text/css                              css;
        image/gif                             gif;
        image/jpeg                            jpeg jpg;
        application/javascript                js;
        text/plain                            txt;
    }

Without this configuration in place the web server might return
`Content-type: text/plain` for an HTML file causing the browser to
show the HTML source code to the user, thus breaking the site.



Consider, for example, the `Content-type` header returned by the web
server. This is not part of the file itself, but is generated by the
web server based on its configuration, such as returning
`Content-type: text/html' for files whose names end in a `.html` or
`.htm`. If this configuration is broken and the web server returns,
e.g., `text/plain` for a file containing HTML, the browser will not
render it correctly and the site will be broken.


XXX


[^1]: In fact, interactive applications that are completely "static" from
the web server's point of view are becoming more and more common these
days. These are called [JAMstack] applications and are popular because
they can be served very quickly from a [CDN].

[JAMstack]: https://jamstack.org/
[CDN]: https://en.wikipedia.org/wiki/Content_delivery_network


##### XXX To-do:

* footnote rendering
* tweak CSS to indent code
* https://www.thesitewizard.com/apache/redirect-domain-www-subdomain.shtml
* .htaccess
* conf.d/
* php.conf
* mention site code in databases (Ã  la WordPress)
